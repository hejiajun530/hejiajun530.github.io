<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>点击放烟花, 右击清空</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      /* background-color: black; */
      /* overflow: hidden; */
    }

    /* @font-face {
      font-family: 'Monoton';
      font-style: normal;
      font-weight: 400;
      src: local('Monoton'), local('Monoton-Regular'), url(http://themes.googleusercontent.com/static/fonts/monoton/v4/AKI-lyzyNHXByGHeOcds_w.woff) format('woff');
    } */

    img {
      position: absolute;
      top: 60%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 500px;
    }

    p {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      font-size: 7em;
      margin: 20px 0 20px 0;
      z-index: 9999;
    }

    a {
      text-decoration: none;
      -webkit-transition: all 0.5s;
      -moz-transition: all 0.5s;
      transition: all 0.5s;
      /* color: #FF1177;
      font-family: Monoton; */
      color: #ffffff;
      -webkit-animation: neon1 1.5s ease-in-out infinite alternate;
      -moz-animation: neon1 1.5s ease-in-out infinite alternate;
      animation: neon1 1.5s ease-in-out infinite alternate;
    }

    @keyframes neon1 {
      from {
        text-shadow: 0 0 10px #fff,
          0 0 20px #fff,
          0 0 30px #fff,
          0 0 60px #FF1177,
          0 0 90px #FF1177,
          0 0 100px #FF1177,
          0 0 120px #FF1177,
          0 0 170px #FF1177;
      }

      to {
        text-shadow: 0 0 5px #fff,
          0 0 10px #fff,
          0 0 15px #fff,
          0 0 20px #FF1177,
          0 0 35px #FF1177,
          0 0 40px #FF1177,
          0 0 50px #FF1177,
          0 0 75px #FF1177;
      }
    }
  </style>


  <!-- 烟花类 和烟花碎屑类 -->
  <script>
    // 烟花
    function Firework(sx, sy, ex, ey, hue) {
      this.sx = sx; // 开始x轴
      this.sy = sy; // 开始y轴
      this.ex = ex; // 结束x轴
      this.ey = ey; // 结束y轴
      this.x = sx; // 实时x轴
      this.y = sy; // 实时y轴
      this.old = new Array(); // 之前的旧角度
      this.speed = random(50, 100);
      this.angle = Math.atan2(ey - sy, ex - sx); // 角度
      this.actualDistance = 0; // 实际路径
      this.distance = countDistance(sx, sy, ex, ey); // 计算总距离
      this.acceleration = 1.05; // 加速
      this.friction = 0.95 //摩擦力
      this.gravity = 1; //重力
      this.hue = hue; // 色调
      this.brightness = random(50, 80); //随机明度
      this.alpha = 1; //初始透明度
      this.decay = random(0.015, 0.03); //碎屑小时的时间
      this.color = "black";
      // 现将old存储两个xy, 防止画出的时候下标溢出
      this.old.push({ x: this.x, y: this.y });
      this.old.push({ x: this.x, y: this.y });
    }
    // 烟花路径更新
    Firework.prototype.update = function () {
      this.old.push({ x: this.x, y: this.y }); // 储存废旧路径
      var x = Math.cos(this.angle) * this.speed;
      var y = Math.sin(this.angle) * this.speed;
      this.actualDistance = countDistance(this.sx, this.sy, this.x + x, this.y + y);
      this.x += x;
      this.y += y;
      this.old.push({ x: this.x, y: this.y });
      if (this.distance < this.actualDistance) // 行走路径大于实际路径
        return false; // 烟花到目标燃放点
      else
        return true; // 烟花未到目标燃放点
    }
    // 爆炸颗粒
    function Particle(x, y, hue) {
      this.x = x;
      this.y = y;
      this.old = new Array(); // 记录步数
      this.angle = random(0, 2 * Math.PI); // 任意角度
      this.speed = random(1, 10); //随机速度
      this.friction = 0.95 //摩擦力
      this.gravity = 1; //重力
      this.hue = random(hue - 20, hue + 20); //生成与烟花色彩相近的碎屑
      this.brightness = random(50, 80); //随机明度
      this.alpha = 1; //初始透明度
      this.decay = random(0.015, 0.03); //碎屑存在时间
      // 现将old存储两个xy, 防止画出的时候下标溢出
      this.old.push({ x: this.x, y: this.y });
      this.old.push({ x: this.x, y: this.y });
    }
    // 爆炸颗粒更新
    Particle.prototype.update = function () {
      this.old.push({ x: this.x, y: this.y });
      this.speed *= this.friction; // 添加重力
      this.x += Math.cos(this.angle) * this.speed; // 计算下一步x轴
      this.y += Math.sin(this.angle) * this.speed + this.gravity; // 计算下一步y轴 + 重力
      this.old.push({ x: this.x, y: this.y });
      this.alpha -= this.decay; // 每走一步消除碎屑透明度
      if (this.alpha < this.decay) { // 碎屑透明度轻于碎屑存在时间
        return false; // 烟花要消失
      } else {
        return true; // 烟花在燃放
      }
    }
    // 爆炸颗粒工厂
    function ParticleFactory(sx, sy, hue) {
      var array = new Array();
      var size = random(50, 500); // 烟花数量
      var scope = random(50, 500); // 烟花范围
      for (var i = 0; i < size; i++) {
        array.push(new Particle(sx, sy, hue));
      }
      return array;
    }
  </script>

  <!-- 工具类 -->
  <script>
    // 随机数
    function random(min, max) {
      return Math.random() * (max - min) + min;
    }
    // 随机颜色
    function randomRgba(min, max) {
      var r = random(0, 255);
      var g = random(0, 255);
      var b = random(0, 255);
      var opacity = random(0.1, 1);
      var color = "rgba(" + r + ", " + g + ", " + b + ", " + opacity + ")";
      return color;
    }
    // 计算角度
    function countDistance(x, y, xx, yy) {
      var a = x - xx;
      var b = y - yy;
      return Math.sqrt(a * a + b * b);
    }
    // 清空画布
    function clear() {
      //	ctx.clearRect(0, 0, width, height);
      ctx.globalCompositeOperation = 'destination-out';
      ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
      ctx.fillRect(0, 0, width, height);
      ctx.globalCompositeOperation = 'lighter';
    }
    // 画线
    function draw(obj) {
      ctx.beginPath();
      ctx.moveTo(obj.old[obj.old.length - 2].x, obj.old[obj.old.length - 2].y);
      ctx.lineTo(obj.x, obj.y);
      ctx.lineWidth = 3;//线条的宽度
      var color = 'hsla(' + obj.hue + ',100%,' + obj.brightness + '%,' + obj.alpha + ')';
      ctx.strokeStyle = color;
      ctx.stroke();
    }
  </script>
</head>

<body>
  <p><a>生日快乐</a></p>
  <img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=3742267843,2369280170&fm=11&gp=0.jpg">
  <!-- <img src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3379743941,2890211479&fm=26&gp=0.jpg"> -->
  <canvas style="background-color:black;" id="canvas"></canvas>

</body>
<script>
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext("2d");
  var width = window.innerWidth, height = window.innerHeight;
  var widthBorder = width * 0.2;// 控制角度
  var heightBorder = height * 0.2;// 控制角度
  canvas.width = width;
  canvas.height = height;

  function Font() {
    // 设置字体
    ctx.font = "100px bold Arial";
    // 设置颜色
    ctx.fillStyle = "#fff";
    // 设置水平对齐方式
    ctx.textAlign = "center";
    // 设置垂直对齐方式
    ctx.textBaseline = "middle";
    // 绘制文字（参数：要写的字，x坐标，y坐标）
    ctx.fillText("生日开乐", canvas.width / 2, canvas.height / 2);
  }

  var fireworks = [];
  var particles = [];

  // 组合
  function create() {
    var x = width / 2;// 烟花起始位置
    var y = height;// 烟花起始位置
    var xx = random(widthBorder, width - widthBorder);// 控制角度
    var yy = random(heightBorder, height - heightBorder);// 控制角度
    fireworks.push(new Firework(x, y, xx, yy, random(0, 360)));
  }

  setInterval(create, 300);// 生成烟花速度

  setInterval(function () {
    var i = fireworks.length;
    clear();
    while (i--) {
      draw(fireworks[i]);
      if (!fireworks[i].update()) {
        draw(fireworks[i]);
        particles = particles.concat(ParticleFactory(fireworks[i].x, fireworks[i].y, fireworks[i].hue));
        fireworks.splice(i, 1);
      }
    }
    i = particles.length;
    while (i--) {
      draw(particles[i]);
      if (!particles[i].update()) {
        draw(particles[i]);
        particles.splice(i, 1);
      }
    }
    // Font();
  }, 60);// 烟花移动速度



  // var utils = {
  //   norm: function (value, min, max) {
  //     return (value - min) / (max - min);
  //   },

  //   lerp: function (norm, min, max) {
  //     return (max - min) * norm + min;
  //   },

  //   map: function (value, sourceMin, sourceMax, destMin, destMax) {
  //     return utils.lerp(utils.norm(value, sourceMin, sourceMax), destMin, destMax);
  //   },

  //   clamp: function (value, min, max) {
  //     return Math.min(Math.max(value, Math.min(min, max)), Math.max(min, max));
  //   },

  //   distance: function (p0, p1) {
  //     var dx = p1.x - p0.x,
  //       dy = p1.y - p0.y;
  //     return Math.sqrt(dx * dx + dy * dy);
  //   },

  //   distanceXY: function (x0, y0, x1, y1) {
  //     var dx = x1 - x0,
  //       dy = y1 - y0;
  //     return Math.sqrt(dx * dx + dy * dy);
  //   },

  //   circleCollision: function (c0, c1) {
  //     return utils.distance(c0, c1) <= c0.radius + c1.radius;
  //   },

  //   circlePointCollision: function (x, y, circle) {
  //     return utils.distanceXY(x, y, circle.x, circle.y) < circle.radius;
  //   },

  //   pointInRect: function (x, y, rect) {
  //     return utils.inRange(x, rect.x, rect.x + rect.radius) &&
  //       utils.inRange(y, rect.y, rect.y + rect.radius);
  //   },

  //   inRange: function (value, min, max) {
  //     return value >= Math.min(min, max) && value <= Math.max(min, max);
  //   },

  //   rangeIntersect: function (min0, max0, min1, max1) {
  //     return Math.max(min0, max0) >= Math.min(min1, max1) &&
  //       Math.min(min0, max0) <= Math.max(min1, max1);
  //   },

  //   rectIntersect: function (r0, r1) {
  //     return utils.rangeIntersect(r0.x, r0.x + r0.width, r1.x, r1.x + r1.width) &&
  //       utils.rangeIntersect(r0.y, r0.y + r0.height, r1.y, r1.y + r1.height);
  //   },

  //   degreesToRads: function (degrees) {
  //     return degrees / 180 * Math.PI;
  //   },

  //   radsToDegrees: function (radians) {
  //     return radians * 180 / Math.PI;
  //   },

  //   randomRange: function (min, max) {
  //     return min + Math.random() * (max - min);
  //   },

  //   randomInt: function (min, max) {
  //     return min + Math.random() * (max - min + 1);
  //   },

  //   getmiddle: function (p0, p1) {
  //     var x = p0.x,
  //       x2 = p1.x;
  //     middlex = (x + x2) / 2;
  //     var y = p0.y,
  //       y2 = p1.y;
  //     middley = (y + y2) / 2;
  //     pos = [middlex, middley];

  //     return pos;
  //   },

  //   getAngle: function (p0, p1) {
  //     var deltaX = p1.x - p0.x;
  //     var deltaY = p1.y - p0.y;
  //     var rad = Math.atan2(deltaY, deltaX);
  //     return rad;
  //   },
  //   inpercentW: function (size) {
  //     return (size * W) / 100;
  //   },

  //   inpercentH: function (size) {
  //     return (size * H) / 100;
  //   },

  // }

  // // basic setup  :) 

  // // canvas = document.getElementById("canvas");
  // // var ctx = canvas.getContext('2d');
  // W = canvas.width = window.innerWidth;
  // H = canvas.height = window.innerHeight;

  // gridX = 5;
  // gridY = 5;

  // function shape(x, y, texte) {
  //   this.x = x;
  //   this.y = y;
  //   this.size = 120;

  //   this.text = texte;
  //   this.placement = [];
  //   this.vectors = [];

  // }

  // shape.prototype.getValue = function () {
  //   console.log("get black pixels position");

  //   // Draw the shape :^)

  //   ctx.textAlign = "center";
  //   ctx.font = "bold " + this.size + "px arial";
  //   ctx.fillText(this.text, this.x, this.y);


  //   var idata = ctx.getImageData(0, 0, W, H);

  //   var buffer32 = new Uint32Array(idata.data.buffer);

  //   for (var y = 0; y < H; y += gridY) {
  //     for (var x = 0; x < W; x += gridX) {

  //       if (buffer32[y * W + x]) {
  //         this.placement.push(new particle(x, y));
  //       }
  //     }
  //   }
  //   ctx.clearRect(0, 0, W, H);

  // }
  // colors = [
  //   '#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5',
  //   '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50',
  //   '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800',
  //   '#FF5722'
  // ];

  // function particle(x, y, type) {
  //   this.radius = 1.1;
  //   this.futurRadius = utils.randomInt(radius, radius + 3);


  //   this.rebond = utils.randomInt(1, 5);
  //   this.x = x;
  //   this.y = y;

  //   this.dying = false;

  //   this.base = [x, y]

  //   this.vx = 0;
  //   this.vy = 0;
  //   this.type = type;
  //   this.friction = .99;
  //   this.gravity = gravity;
  //   this.color = colors[Math.floor(Math.random() * colors.length)];

  //   this.getSpeed = function () {
  //     return Math.sqrt(this.vx * this.vx + this.vy * this.vy);
  //   };

  //   this.setSpeed = function (speed) {
  //     var heading = this.getHeading();
  //     this.vx = Math.cos(heading) * speed;
  //     this.vy = Math.sin(heading) * speed;
  //   };

  //   this.getHeading = function () {
  //     return Math.atan2(this.vy, this.vx);
  //   };

  //   this.setHeading = function (heading) {
  //     var speed = this.getSpeed();
  //     this.vx = Math.cos(heading) * speed;
  //     this.vy = Math.sin(heading) * speed;
  //   };

  //   this.angleTo = function (p2) {
  //     return Math.atan2(p2.y - this.y, p2.x - this.x);

  //   };

  //   this.update = function (heading) {
  //     this.x += this.vx;
  //     this.y += this.vy;
  //     this.vy += gravity;

  //     this.vx *= this.friction;
  //     this.vy *= this.friction;

  //     if (this.radius < this.futurRadius && this.dying === false) {
  //       this.radius += duration;
  //     } else {
  //       this.dying = true;
  //     }

  //     if (this.dying === true) {
  //       this.radius -= duration;


  //     }


  //     ctx.beginPath();

  //     ctx.fillStyle = this.color;

  //     ctx.arc(this.x, this.y, this.radius, Math.PI * 2, false);
  //     ctx.fill();
  //     ctx.closePath();

  //     if (this.y < 0 || this.radius < 1) {
  //       this.x = this.base[0];
  //       this.dying = false;
  //       this.y = this.base[1];
  //       this.radius = 1.1;
  //       this.setSpeed(speed);
  //       this.futurRadius = utils.randomInt(radius, radius + 3);
  //       this.setHeading(utils.randomInt(utils.degreesToRads(0), utils.degreesToRads(360)));
  //     }

  //   };

  //   this.setSpeed(utils.randomInt(.1, .5));
  //   this.setHeading(utils.randomInt(utils.degreesToRads(0), utils.degreesToRads(360)));

  // }
  // // element2 = document.getElementById("2");
  // // element3 = document.getElementById("3");
  // // element4 = document.getElementById("4");
  // // element5 = document.getElementById("5");
  // // element6 = document.getElementById("6");

  // fieldvalue = "生日快乐";
  // // gravity = parseFloat(element2.value);
  // // duration = parseFloat(element3.value);
  // // resolution = parseFloat(element4.value);
  // // speed = parseFloat(element5.value);
  // // radius = parseFloat(element5.value);
  // gravity = 0;
  // duration = 0.4;
  // resolution = 5;
  // speed = 0.1;
  // radius = 2;

  // var message = new shape(W / 2, H / 2 + 50, fieldvalue);

  // message.getValue();

  // update();

  // function change() {
  //   ctx.clearRect(0, 0, W, H);

  //   gridX = parseFloat(element4.value);
  //   gridY = parseFloat(element4.value);
  //   message.placement = [];
  //   message.text = fieldvalue;
  //   message.getValue();
  // }


  // function changeV() {
  //   gravity = parseFloat(element2.value);
  //   duration = parseFloat(element3.value);
  //   speed = parseFloat(element5.value);
  //   radius = parseFloat(element6.value);
  // }

  // var fps = 100;
  // function update() {
  //   setTimeout(function () {
  //     // ctx.clearRect(0, 0, W, H);


  //     for (var i = 0; i < message.placement.length; i++) {
  //       message.placement[i].update();
  //     }

  //     requestAnimationFrame(update);
  //   }, 1000 / fps);
  // }

</script>